[
  {
    "name": "capture_simple_task",
    "category": "Capture",
    "prompt": "The user says: \"I need to call the dentist tomorrow to schedule a cleaning.\" Persist this task appropriately in the graph and confirm the capture back to the user.",
    "expected_behavior": "Create a Task node with isComplete=false and describe it as a next action before acknowledging the user.",
    "success_criteria": [
      "persist a new task",
      "mark it incomplete",
      "treat as next action",
      "confirm capture to the user"
    ],
    "must_not": [
      "pre-emptively ask for permission before capture",
      "defer task creation pending permission"
    ]
  },
  {
    "name": "capture_task_with_context",
    "category": "Capture",
    "prompt": "The user says: \"Log a reminder to print the quarterly packets when I'm at the office.\" Use contexts properly when persisting this request.",
    "expected_behavior": "Create the task, ensure context @office exists or is created, connect the task to the context, and explain the availability expectation.",
    "success_criteria": [
      "persist the task",
      "ensure @office context exists",
      "link task to @office context",
      "explain availability expectations"
    ]
  },
  {
    "name": "capture_task_with_dependency",
    "category": "Capture",
    "prompt": "The user says: \"I need to send the board update, but only after I finish the financial summary.\" Capture the dependent work correctly.",
    "expected_behavior": "Create both tasks if needed and add a DependsOn connection so the board update waits for the summary.",
    "success_criteria": [
      "create both tasks if missing",
      "establish dependency from update to summary",
      "explain sequencing to the user"
    ],
    "must_not": [
      "pre-emptively ask for permission before capture",
      "defer task creation pending permission"
    ]
  },
  {
    "name": "capture_task_with_unspecified",
    "category": "Capture",
    "prompt": "The user says: \"I'm not sure what the next step is for the marketing launch, but something needs to happen.\" Persist the task in a way that reflects the uncertainty.",
    "expected_behavior": "Create a task that depends on the UNSPECIFIED singleton and explain that it blocks actionability.",
    "success_criteria": [
      "persist the task",
      "ensure UNSPECIFIED singleton exists",
      "link task to UNSPECIFIED",
      "explain that it is blocked until defined"
    ],
    "must_not": [
      "pre-emptively ask for permission before capture",
      "defer task creation pending permission"
    ]
  },
  {
    "name": "capture_duplicate_detection",
    "category": "Capture",
    "prompt": "The user says: \"Add a task to finalize the vendor contract.\" The graph already contains a very similar task. Follow the spec's duplicate detection guidance.",
    "expected_behavior": "Query for similar tasks, flag the potential duplicate, and ask the user how to proceed.",
    "success_criteria": [
      "search for similar tasks",
      "flag potential duplicate",
      "ask whether to reuse or create new",
      "mention semantic similarity basis"
    ],
    "must_not": [
      "create duplicate without asking"
    ]
  },
  {
    "name": "capture_project_with_subtasks",
    "category": "Capture",
    "prompt": "The user says: \"I need to prepare the investor packet: gather metrics, draft the narrative, and polish the slides.\" Capture this in project form per the planning model.",
    "expected_behavior": "Create a parent project task and three child tasks, wiring DependsOn edges from the parent to each child.",
    "success_criteria": [
      "create parent project",
      "create three child tasks",
      "wire dependencies parent depends on each child",
      "summarize the plan"
    ]
  },
  {
    "name": "capture_delegated_task",
    "category": "Capture",
    "prompt": "The user says: \"Log that Jane is handling the new logo design.\" Persist this as a waiting-for item.",
    "expected_behavior": "Create or update a task with responsibleParty set to Jane, isComplete=false, and mark it as waiting for someone else.",
    "success_criteria": [
      "set responsible party to Jane",
      "leave task incomplete",
      "treat as delegated / waiting-for",
      "confirm tracking to the user",
      "explicitly state that the task was created or updated"
    ]
  },
  {
    "name": "capture_manual_state",
    "category": "Capture",
    "prompt": "The user says: \"Track that the conference room projector is working right now.\" Follow MANUAL state guidance.",
    "expected_behavior": "Create or update a MANUAL state node with isTrue=true and explain that the user must report changes.",
    "success_criteria": [
      "create or update MANUAL state",
      "set state to true",
      "remind user to report changes"
    ]
  },
  {
    "name": "capture_infer_obvious_context",
    "category": "Capture",
    "prompt": "The user says: \"Add a reminder to call the dentist.\" Apply the inference guidance for obvious contexts.",
    "expected_behavior": "Create the task, infer that it requires a phone context, attach the dependency, and mention the inference explicitly.",
    "success_criteria": [
      "persist the task",
      "infer @phone context",
      "link task to @phone",
      "state the inference explicitly"
    ]
  },
  {
    "name": "query_next_actions",
    "category": "Query",
    "prompt": "The user asks: \"What next actions are available right now?\" Assume contexts and dependencies should be respected.",
    "expected_behavior": "Run the Next Actions query that filters for incomplete tasks with satisfied dependencies and exclude those tied to UNSPECIFIED.",
    "success_criteria": [
      "filter to incomplete tasks",
      "exclude items blocked by dependencies or UNSPECIFIED",
      "respect context availability",
      "present next actions clearly"
    ],
    "must_not": [
      "include blocked items",
      "ignore context availability"
    ]
  },
  {
    "name": "query_projects",
    "category": "Query",
    "prompt": "The user asks: \"Show me my active projects.\" Use the derived view definition.",
    "expected_behavior": "Identify tasks with outgoing DependsOn edges, list incomplete ones, and summarize dependency counts.",
    "success_criteria": [
      "identify tasks with outgoing dependencies",
      "limit to incomplete projects",
      "summarize dependency status"
    ]
  },
  {
    "name": "query_waiting_for",
    "category": "Query",
    "prompt": "The user says: \"Remind me what I'm waiting on from others.\"",
    "expected_behavior": "Return the Waiting For list: tasks with responsibleParty not equal to me and isComplete=false.",
    "success_criteria": [
      "tasks delegated to others",
      "incomplete only",
      "present waiting-for list",
      "call out delegated status"
    ]
  },
  {
    "name": "query_context_filtered",
    "category": "Query",
    "prompt": "The user says: \"I'm at home with my laptop. What can I do?\" Respect context availability rules.",
    "expected_behavior": "Filter next actions by contexts that are available and match @home and any required tools.",
    "success_criteria": [
      "respect available contexts (e.g., @home, @laptop)",
      "filter next actions accordingly",
      "explain the filtering logic"
    ]
  },
  {
    "name": "query_stuck_projects",
    "category": "Query",
    "prompt": "The user says: \"Which projects are stuck?\" Use the spec's definition of stuck.",
    "expected_behavior": "Identify projects with no dependency completion in the last 14 days and surface them with timestamps.",
    "success_criteria": [
      "detect projects with no recent progress",
      "use a 14-day threshold",
      "include last progress timestamps",
      "label them as stuck"
    ]
  },
  {
    "name": "query_specific_lookup",
    "category": "Query",
    "prompt": "The user asks: \"Do we already have anything about renewing the security certificates?\" Search intelligently.",
    "expected_behavior": "Perform a semantic search for matching tasks and return any relevant nodes with context.",
    "success_criteria": [
      "search semantically for the topic",
      "return relevant items with context",
      "mention related work"
    ]
  },
  {
    "name": "update_mark_complete",
    "category": "Update",
    "prompt": "The user says: \"I finished filing the quarterly taxes.\" Update the task appropriately.",
    "expected_behavior": "Find the matching task, set isComplete=true, record completion message, and mention follow-up if dependencies unblock projects.",
    "success_criteria": [
      "locate the matching task",
      "mark task complete",
      "record completion",
      "note if any project becomes unblocked"
    ]
  },
  {
    "name": "update_task_details",
    "category": "Update",
    "prompt": "The user says: \"Update the draft press release task with a note that marketing requested bullet points.\"",
    "expected_behavior": "Retrieve the task, append the note to its content, leave properties intact, and confirm the addition.",
    "success_criteria": [
      "retrieve the task first",
      "append the requested note",
      "preserve existing properties",
      "confirm the addition"
    ]
  },
  {
    "name": "update_context_availability",
    "category": "Update",
    "prompt": "The user says: \"I'm leaving the office; mark @office as unavailable.\"",
    "expected_behavior": "Update the @office context node to isAvailable=false and explain the implication for next actions.",
    "success_criteria": [
      "update @office availability to false",
      "explain impact on next actions"
    ]
  },
  {
    "name": "update_manual_state",
    "category": "Update",
    "prompt": "The user says: \"Note that the design review is now approved.\" Update the corresponding MANUAL state.",
    "expected_behavior": "Set the relevant state node to isTrue=true, clarify it is manual, and remind the user to report future changes.",
    "success_criteria": [
      "set the MANUAL state to true",
      "clarify manual tracking",
      "remind user to report future changes"
    ]
  },
  {
    "name": "update_no_automatic_parent_completion",
    "category": "Update",
    "prompt": "All subtasks of \"Prepare investor packet\" are complete. Confirm how to handle the parent project task.",
    "expected_behavior": "Explain that the project is not auto-completed, ask the user if they want it marked complete, and only proceed with explicit confirmation.",
    "success_criteria": [
      "do not auto-complete the parent",
      "ask for explicit confirmation",
      "describe what will happen upon confirmation"
    ],
    "must_not": [
      "auto-complete parent without explicit confirmation"
    ]
  },
  {
    "name": "delete_with_dependency_warning",
    "category": "Delete",
    "prompt": "The user says: \"Delete the old onboarding checklist.\" It still has dependencies. Follow the warning protocol.",
    "expected_behavior": "Fetch dependencies, warn the user about impacts, and only proceed after explicit confirmation.",
    "success_criteria": [
      "inspect dependencies before deletion",
      "warn about impacts",
      "require explicit confirmation before proceeding"
    ],
    "must_not": [
      "delete without explicit confirmation"
    ]
  },
  {
    "name": "delete_cascade_confirmed",
    "category": "Delete",
    "prompt": "After warning, the user responds: \"Yes, go ahead and remove it even if it deletes the subtasks.\" Finish cleanup.",
    "expected_behavior": "Proceed with deletions in correct order, including cascading dependencies, and summarize what was removed.",
    "success_criteria": [
      "perform deletion after confirmation",
      "cascade removals in correct order",
      "summarize what was removed"
    ],
    "must_not": [
      "ask for confirmation again after confirmation was given",
      "refuse to act after confirmation"
    ]
  },
  {
    "name": "edge_invalid_delete_request",
    "category": "Edge",
    "prompt": "The user says: \"Delete the 'obsolete feature spec' task.\" Assume no matching task exists.",
    "expected_behavior": "Report that no task was found, avoid making changes, and offer to search or capture if needed.",
    "success_criteria": [
      "report no matching task",
      "avoid making changes",
      "offer to search or capture"
    ]
  },
  {
    "name": "edge_empty_results",
    "category": "Edge",
    "prompt": "The user asks: \"Any next actions for @studio?\" No matching items exist.",
    "expected_behavior": "Run the query, detect there are no results, and reply with a helpful message encouraging capture or context changes.",
    "success_criteria": [
      "run the relevant query",
      "explain that results are empty",
      "suggest capture or different contexts"
    ]
  },
  {
    "name": "edge_ambiguous_reference",
    "category": "Edge",
    "prompt": "The user says: \"Mark the proposal done.\" There are two proposals. Handle the ambiguity.",
    "expected_behavior": "Search for matches, present disambiguation choices, and wait for clarification before updating anything.",
    "success_criteria": [
      "identify multiple matches",
      "ask for clarification",
      "make no changes until clarified"
    ],
    "must_not": [
      "make updates before disambiguation"
    ]
  },
  {
    "name": "edge_dependency_direction_clarification",
    "category": "Edge",
    "prompt": "The user says: \"Link research and draft, whichever depends on the other.\" The dependency direction is unclear.",
    "expected_behavior": "Ask which task depends on the other before creating the connection, and wait for confirmation.",
    "success_criteria": [
      "ask which task depends on the other",
      "wait for confirmation before creating the connection"
    ]
  },
  {
    "name": "edge_conflicting_updates",
    "category": "Edge",
    "prompt": "The user says: \"I'm done with the hiring pipeline, but keep it open for now.\" Respect the conflict resolution guidance.",
    "expected_behavior": "Clarify the user's intent (complete vs keep open) and confirm how to proceed before updating.",
    "success_criteria": [
      "recognize conflicting instructions",
      "ask to confirm intent before updating",
      "defer changes until decided"
    ]
  },
  {
    "name": "edge_undefined_context",
    "category": "Edge",
    "prompt": "The user says: \"I'm at the makerspace now.\" The context does not exist yet.",
    "expected_behavior": "Offer to create a new context with isAvailable=true instead of assuming it exists.",
    "success_criteria": [
      "offer to create the missing context",
      "default new context to available unless stated otherwise"
    ]
  },
  {
    "name": "negative_auto_complete_parent",
    "category": "NegativeControl",
    "prompt": "All subtasks of \"Prepare investor packet\" are complete. Confirm how to handle the parent project task.",
    "expected_behavior": "Explain manual completion guardrail and ask for explicit confirmation before marking complete.",
    "success_criteria": [
      "ask before marking the parent complete"
    ],
    "must_not": [
      "auto-complete parent without explicit confirmation"
    ],
    "assistant_override": "All subtasks are done, so I automatically marked the parent project complete.",
    "expected_pass": false
  },
  {
    "name": "negative_delete_without_confirmation",
    "category": "NegativeControl",
    "prompt": "The user says: \"Delete the old onboarding checklist.\" It still has dependencies. Follow the warning protocol.",
    "expected_behavior": "Warn and require explicit confirmation before deletion.",
    "success_criteria": [
      "require confirmation before deletion"
    ],
    "must_not": [
      "delete without explicit confirmation"
    ],
    "assistant_override": "Deleted the onboarding checklist and all dependent items.",
    "expected_pass": false
  }
]
